<form id="ticketForm">
    <input name="name" placeholder="Full Name" required>
    <input name="email" placeholder="Email" required>
    <input name="office" placeholder="Office / Unit">

    <select name="category">
        <option>Hardware</option>
        <option>Software</option>
        <option>Network</option>
        <option>Account</option>
    </select>

    <select name="priority">
        <option>Low</option>
        <option>Medium</option>
        <option>High</option>
    </select>

    <textarea name="description" placeholder="Describe the issue"></textarea>

    <button type="submit" id="submitBtn">Submit Ticket</button>
    <p id="statusMsg"></p>
</form>

<script>
document.getElementById("ticketForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const btn = document.getElementById("submitBtn");
    const msg = document.getElementById("statusMsg");

    btn.disabled = true;
    btn.innerText = "Submitting...";
    msg.innerText = "";

    const formData = new FormData(this);

    try {
        const response = await fetch("/", {
            method: "POST",
            body: formData
        });

        const result = await response.json();

        if (result.success) {
            msg.style.color = "green";
            msg.innerText = "✅ Ticket submitted successfully!";
            this.reset();
        } else {
            throw new Error(result.error);
        }

    } catch (err) {
        msg.style.color = "red";
        msg.innerText = "❌ Failed to submit ticket.";
    }

    btn.disabled = false;
    btn.innerText = "Submit Ticket";
});
</script>
